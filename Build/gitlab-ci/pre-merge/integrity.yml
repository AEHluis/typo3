phpstan php 7.4 pre-merge:
  stage: main
  except:
    - schedules
  cache:
    key: master-composer-phpstan
    paths:
      - .cache
  script:
    - Build/Scripts/runTests.sh -s composerInstall -p 7.4
    - Build/Scripts/runTests.sh -s phpstan -p 7.4


doc block check php 7.4 pre-merge:
  stage: main
  except:
    - schedules
  script:
    - Build/Scripts/runTests.sh -s composerInstall -p 7.4
    - Build/Scripts/runTests.sh -s docBlockCheck -p 7.4


annotations php 7.4 pre-merge:
  stage: main
  except:
    - schedules
  script:
    - Build/Scripts/runTests.sh -s composerInstall -p 7.4
    - Build/Scripts/runTests.sh -s checkAnnotations -p 7.4


integration various php 7.4 pre-merge:
  stage: main
  except:
    - schedules
  script:
    - Build/Scripts/runTests.sh -s composerInstall -p 7.4
    - Build/Scripts/runTests.sh -s checkExceptionCodes -p 7.4
    - Build/Scripts/runTests.sh -s checkGitSubmodule -p 7.4
    # broken on gitlab for now
    # @todo: try to set up gitlab with FF_DISABLE_UMASK_FOR_DOCKER_EXECUTOR and have a non-root user setup for containers
    # - Build/Scripts/runTests.sh -s checkPermissions -p 7.4
    - Build/Scripts/runTests.sh -s checkXlf -p 7.4
    - Build/Scripts/runTests.sh -s checkRst -p 7.4
    - Build/Scripts/runTests.sh -s checkFilePathLength -p 7.4
    - Build/Scripts/runTests.sh -s checkExtensionScannerRst -p 7.4
    - Build/Scripts/runTests.sh -s checkCsvFixtures -p 7.4
    - Build/Scripts/runTests.sh -s checkBom -p 7.4
    - Build/Scripts/runTests.sh -s checkComposer -p 7.4

grunt clean pre-merge:
  stage: main
  except:
    - schedules
  cache:
    key: master-js
    paths:
      - .cache
  script:
    - Build/Scripts/runTests.sh -s checkGruntClean
