acceptance application mariadb php 8.1 locked:
  stage: acceptance
  needs: []
  only:
    - schedules
  artifacts:
    when: on_failure
    paths:
      - typo3temp/var/tests/acceptance/typo3temp/var/log
      - typo3temp/var/tests/AcceptanceReports
    reports:
      junit:
        - typo3temp/var/tests/AcceptanceReports/reports.xml
  parallel: 8
  script:
    - Build/Scripts/runTests.sh -s composerInstall -p 8.1
    - Build/Scripts/runTests.sh -s acceptance -d mariadb -i 10.3 -p 8.1 -c $CI_NODE_INDEX/$CI_NODE_TOTAL
  # Always retry a failed job, so it has a chance to recover from a faulty machine or timing issue
  retry: 1
acceptance application mariadb php 8.1 max:
  stage: acceptance
  needs: []
  only:
    - schedules
  cache:
    key: main-composer-max
    paths:
      - .cache
  artifacts:
    when: on_failure
    paths:
      - typo3temp/var/tests/acceptance/typo3temp/var/log
      - typo3temp/var/tests/AcceptanceReports
    reports:
      junit:
        - typo3temp/var/tests/AcceptanceReports/reports.xml
  parallel: 8
  script:
    - Build/Scripts/runTests.sh -s composerInstallMax -p 8.1
    - Build/Scripts/runTests.sh -s acceptance -d mariadb -i 10.3 -p 8.1 -c $CI_NODE_INDEX/$CI_NODE_TOTAL
  # Always retry a failed job, so it has a chance to recover from a faulty machine or timing issue
  retry: 1
acceptance application mariadb php 8.1 min:
  stage: acceptance
  needs: []
  only:
    - schedules
  cache:
    key: main-composer-min
    paths:
      - .cache
  artifacts:
    when: on_failure
    paths:
      - typo3temp/var/tests/acceptance/typo3temp/var/log
      - typo3temp/var/tests/AcceptanceReports
    reports:
      junit:
        - typo3temp/var/tests/AcceptanceReports/reports.xml
  parallel: 8
  script:
    - Build/Scripts/runTests.sh -s composerInstallMin -p 8.1
    - Build/Scripts/runTests.sh -s acceptance -d mariadb -i 10.3 -p 8.1 -c $CI_NODE_INDEX/$CI_NODE_TOTAL
  # Always retry a failed job, so it has a chance to recover from a faulty machine or timing issue
  retry: 1

acceptance application mysql php 8.1 locked:
  stage: acceptance
  needs: []
  only:
    - schedules
  artifacts:
    when: on_failure
    paths:
      - typo3temp/var/tests/acceptance/typo3temp/var/log
      - typo3temp/var/tests/AcceptanceReports
    reports:
      junit:
        - typo3temp/var/tests/AcceptanceReports/reports.xml
  parallel: 8
  script:
    - Build/Scripts/runTests.sh -s composerInstall -p 8.1
    - Build/Scripts/runTests.sh -s acceptance -d mysql -j 8.0 -p 8.1 -c $CI_NODE_INDEX/$CI_NODE_TOTAL
  # Always retry a failed job, so it has a chance to recover from a faulty machine or timing issue
  retry: 1
acceptance application mysql php 8.1 max:
  stage: acceptance
  needs: []
  only:
    - schedules
  cache:
    key: main-composer-max
    paths:
      - .cache
  artifacts:
    when: on_failure
    paths:
      - typo3temp/var/tests/acceptance/typo3temp/var/log
      - typo3temp/var/tests/AcceptanceReports
    reports:
      junit:
        - typo3temp/var/tests/AcceptanceReports/reports.xml
  parallel: 8
  script:
    - Build/Scripts/runTests.sh -s composerInstallMax -p 8.1
    - Build/Scripts/runTests.sh -s acceptance -d mysql -j 8.0 -p 8.1 -c $CI_NODE_INDEX/$CI_NODE_TOTAL
  # Always retry a failed job, so it has a chance to recover from a faulty machine or timing issue
  retry: 1
acceptance application mysql php 8.1 min:
  stage: acceptance
  needs: []
  only:
    - schedules
  cache:
    key: main-composer-min
    paths:
      - .cache
  artifacts:
    when: on_failure
    paths:
      - typo3temp/var/tests/acceptance/typo3temp/var/log
      - typo3temp/var/tests/AcceptanceReports
    reports:
      junit:
        - typo3temp/var/tests/AcceptanceReports/reports.xml
  parallel: 8
  script:
    - Build/Scripts/runTests.sh -s composerInstallMin -p 8.1
    - Build/Scripts/runTests.sh -s acceptance -d mysql -j 8.0 -p 8.1 -c $CI_NODE_INDEX/$CI_NODE_TOTAL
  # Always retry a failed job, so it has a chance to recover from a faulty machine or timing issue
  retry: 1

acceptance application sqlite php 8.1 locked:
  stage: acceptance
  needs: []
  only:
    - schedules
  artifacts:
    when: on_failure
    paths:
      - typo3temp/var/tests/acceptance/typo3temp/var/log
      - typo3temp/var/tests/AcceptanceReports
    reports:
      junit:
        - typo3temp/var/tests/AcceptanceReports/reports.xml
  parallel: 8
  script:
    - Build/Scripts/runTests.sh -s composerInstall -p 8.1
    - Build/Scripts/runTests.sh -s acceptance -d sqlite -p 8.1 -c $CI_NODE_INDEX/$CI_NODE_TOTAL
  # Always retry a failed job, so it has a chance to recover from a faulty machine or timing issue
  retry: 1
acceptance application sqlite php 8.1 max:
  stage: acceptance
  needs: []
  only:
    - schedules
  cache:
    key: main-composer-max
    paths:
      - .cache
  artifacts:
    when: on_failure
    paths:
      - typo3temp/var/tests/acceptance/typo3temp/var/log
      - typo3temp/var/tests/AcceptanceReports
    reports:
      junit:
        - typo3temp/var/tests/AcceptanceReports/reports.xml
  parallel: 8
  script:
    - Build/Scripts/runTests.sh -s composerInstallMax -p 8.1
    - Build/Scripts/runTests.sh -s acceptance -d sqlite -p 8.1 -c $CI_NODE_INDEX/$CI_NODE_TOTAL
  # Always retry a failed job, so it has a chance to recover from a faulty machine or timing issue
  retry: 1
acceptance application sqlite php 8.1 min:
  stage: acceptance
  needs: []
  only:
    - schedules
  cache:
    key: main-composer-min
    paths:
      - .cache
  artifacts:
    when: on_failure
    paths:
      - typo3temp/var/tests/acceptance/typo3temp/var/log
      - typo3temp/var/tests/AcceptanceReports
    reports:
      junit:
        - typo3temp/var/tests/AcceptanceReports/reports.xml
  parallel: 8
  script:
    - Build/Scripts/runTests.sh -s composerInstallMin -p 8.1
    - Build/Scripts/runTests.sh -s acceptance -d sqlite -p 8.1 -c $CI_NODE_INDEX/$CI_NODE_TOTAL
  # Always retry a failed job, so it has a chance to recover from a faulty machine or timing issue
  retry: 1

# @todo New acceptance tests with postgres has some issues, so we leave them
#       disabled for now before adding more unstable acceptance tests.
#acceptance application postgres php 8.1 locked:
#  stage: acceptance
#  needs: []
#  only:
#    - schedules
#  artifacts:
#    when: on_failure
#    paths:
#      - typo3temp/var/tests/acceptance/typo3temp/var/log
#      - typo3temp/var/tests/AcceptanceReports
#  parallel: 8
#  script:
#    - Build/Scripts/runTests.sh -s composerInstall -p 8.1
#    - Build/Scripts/runTests.sh -s acceptance -d postgres -k 10 -p 8.1 -c $CI_NODE_INDEX/$CI_NODE_TOTAL
#  # Always retry a failed job, so it has a chance to recover from a faulty machine or timing issue
#  retry: 1
#acceptance application postgres php 8.1 max:
#  stage: acceptance
#  needs: []
#  only:
#    - schedules
#  cache:
#    key: main-composer-max
#    paths:
#      - .cache
#  artifacts:
#    when: on_failure
#    paths:
#      - typo3temp/var/tests/acceptance/typo3temp/var/log
#      - typo3temp/var/tests/AcceptanceReports
#  parallel: 8
#  script:
#    - Build/Scripts/runTests.sh -s composerInstallMax -p 8.1
#    - Build/Scripts/runTests.sh -s acceptance -d postgres -k 10 -p 8.1 -c $CI_NODE_INDEX/$CI_NODE_TOTAL
#  # Always retry a failed job, so it has a chance to recover from a faulty machine or timing issue
#  retry: 1
#acceptance application postgres php 8.1 min:
#  stage: acceptance
#  needs: []
#  only:
#    - schedules
#  cache:
#    key: main-composer-min
#    paths:
#      - .cache
#  artifacts:
#    when: on_failure
#    paths:
#      - typo3temp/var/tests/acceptance/typo3temp/var/log
#      - typo3temp/var/tests/AcceptanceReports
#  parallel: 8
#  script:
#    - Build/Scripts/runTests.sh -s composerInstallMin -p 8.1
#    - Build/Scripts/runTests.sh -s acceptance -d postgres -k 10 -p 8.1 -c $CI_NODE_INDEX/$CI_NODE_TOTAL
#  # Always retry a failed job, so it has a chance to recover from a faulty machine or timing issue
#  retry: 1
